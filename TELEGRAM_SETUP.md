# Настройка отправки формы в Telegram

## Список изменённых/удалённых файлов

1. **Обновлены файлы:**
   - `src/components/BookingForm.tsx` - обновлен компонент формы
   - `pages/api/send-telegram.js` - обновлен API-обработчик
   - `.gitignore` - добавлено исключение для `.env.local`

2. **Созданы новые файлы:**
   - `app/api/send-telegram/route.js` - альтернативный API-обработчик для Next.js App Router
   - `.env.local.example` - пример файла с переменными окружения

## Настройка переменных окружения

### Локальная разработка

1. Создайте файл `.env.local` в корне проекта на основе `.env.local.example`:
   ```
   # Telegram Bot API токен (получите у @BotFather)
   TELEGRAM_BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN_HERE
   
   # ID чата или канала для отправки сообщений
   TELEGRAM_CHAT_ID=YOUR_TELEGRAM_CHAT_ID_HERE
   ```

2. Замените плейсхолдеры на реальные значения:
   - `YOUR_TELEGRAM_BOT_TOKEN_HERE` - токен бота, полученный у @BotFather
   - `YOUR_TELEGRAM_CHAT_ID_HERE` - ID чата или канала для отправки сообщений

### Настройка на Vercel

1. Откройте проект в панели управления Vercel
2. Перейдите в раздел **Settings** → **Environment Variables**
3. Добавьте переменные:
   - `TELEGRAM_BOT_TOKEN` - токен бота Telegram
   - `TELEGRAM_CHAT_ID` - ID чата или канала
4. Выберите окружения, в которых будут доступны переменные:
   - Production (для продакшн-окружения)
   - Preview (для превью-деплоев)
   - Development (для локальной разработки с Vercel CLI)
5. Нажмите **Save** для сохранения переменных

После добавления переменных окружения необходимо выполнить редеплой проекта:
- В панели управления Vercel нажмите **Deployments** → выберите последний деплой → **Redeploy**
- Или сделайте новый коммит и пуш в репозиторий

## Команды для тестирования и деплоя

### Локальное тестирование

1. Запустите локальный сервер разработки:
   ```bash
   npm run dev
   # или
   yarn dev
   ```

2. Тестирование API с помощью curl:
   ```bash
   curl -X POST http://localhost:3000/api/send-telegram \
     -H "Content-Type: application/json" \
     -d '{"name":"Тестовый Пользователь","phone":"+7 (999) 123-45-67","service":"Тестовая услуга","message":"Тестовое сообщение"}'
   ```

3. Ожидаемый ответ при успешной отправке:
   ```json
   {
     "success": true,
     "message": "Сообщение успешно отправлено в Telegram"
   }
   ```

4. Пример ответа при ошибке:
   ```json
   {
     "success": false,
     "error": "Пожалуйста, заполните все обязательные поля (имя, телефон, услуга)"
   }
   ```

### Деплой на Vercel

1. Коммит и пуш изменений:
   ```bash
   git add .
   git commit -m "Обновлена логика отправки формы в Telegram"
   git push origin main
   ```

2. Vercel автоматически запустит деплой при пуше в репозиторий.

## Безопасность и лучшие практики

1. **Хранение токенов:**
   - Никогда не храните токены и секреты в коде
   - Всегда используйте переменные окружения
   - Файл `.env.local` добавлен в `.gitignore` для предотвращения утечки секретов

2. **Ограничение частоты запросов:**
   - Рекомендуется добавить ограничение на количество запросов с одного IP-адреса
   - Можно использовать middleware или сторонние сервисы для защиты от спама

3. **GDPR и согласие пользователей:**
   - Форма содержит чекбокс согласия на обработку персональных данных
   - Убедитесь, что у вас есть политика конфиденциальности, объясняющая, как вы обрабатываете данные
   - Храните только необходимые данные и удаляйте их, когда они больше не нужны

## Итоговый чек-лист внедрения

1. ✅ Обновить компонент формы (`src/components/BookingForm.tsx`)
2. ✅ Обновить API-обработчик (`pages/api/send-telegram.js`)
3. ✅ Создать альтернативный API-обработчик для App Router (`app/api/send-telegram/route.js`)
4. ✅ Создать пример файла `.env.local.example`
5. ✅ Обновить `.gitignore` для исключения `.env.local`
6. ⬜ Создать файл `.env.local` с реальными значениями (локально)
7. ⬜ Добавить переменные окружения в Vercel
8. ⬜ Протестировать отправку формы локально
9. ⬜ Закоммитить и запушить изменения
10. ⬜ Проверить работу формы на продакшн-сайте